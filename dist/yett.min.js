!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.yett={})}(this,function(exports){"use strict";var TYPE_ATTRIBUTE="javascript/blocked",jsonStringify=function(t){return JSON.stringify(t,replacer,2)},jsonParse=function(t){return JSON.parse(t,reviver)},patternsObj={blacklist:null,whitelist:null},patterns={blacklist:window.localStorage.YETT_BLACKLIST?jsonParse(window.localStorage.YETT_BLACKLIST):window.YETT_BLACKLIST,whitelist:window.localStorage.YETT_WHITELIST?jsonParse(window.localStorage.YETT_WHITELIST):window.YETT_WHITELIST,tags:[]};!(patterns.blacklist instanceof Array)&&patterns.blacklist instanceof Object&&(patternsObj.blacklist=patterns.blacklist,patterns.blacklist=Object.values(patternsObj.blacklist)),!(patterns.whitelist instanceof Array)&&patterns.whitelist instanceof Object&&(patternsObj.whitelist=patterns.whitelist,patterns.whitelist=Object.values(patternsObj.whitelist)),patterns.blacklist&&patterns.blacklist.forEach(function(t){if("string"==typeof t){var e=t.indexOf("/");if(e>1){var r=t.substring(0,e);r.length>1&&patterns.tags.push(r)}}});var backupScripts={blacklisted:[]},blockNodeNoBackup=function blockNodeNoBackup(node,blockingType,attribute){if("string"==typeof blockingType&&"remove"!=blockingType){var arr=blockingType.split(":"),type="src",value=null;if(arr.length<1?value=arr[0]:(type=arr[0],value=arr[1]),type||(type="src"),type.startsWith("_backup_")||"type"==type)return!1;if(node.type!=TYPE_ATTRIBUTE&&(node._backup_type=node.type,node.type=TYPE_ATTRIBUTE),"javascript"==type)eval(value);else{if(node["_backup_"+type]=node[type],attribute===type)return value;node[type]=value}return!0}return!1},blockNode=function(t,e){var r=t.parentElement;return!!r&&(backupScripts.blacklisted.push([t.cloneNode(!0),r]),!0===e||"remove"===e?(r.removeChild(t),!0):blockNodeNoBackup(t,e))};function replacer(t,e){return e instanceof RegExp?"__REGEXP "+e.toString():e}function reviver(t,e){if(0==e.toString().indexOf("__REGEXP ")){var r=e.split("__REGEXP ")[1].match(/\/(.*)\/(.*)?/);return new RegExp(r[1],r[2]||"")}return e}var testPattern=function testPattern(pattern,node){if("string"==typeof node)if(node.startsWith("http")||"/"!=node.slice(-1)||2!=(node.replace(/\\/g,"").match(/\//g)||[]).length)node={src:node,tagName:null};else{var _pos=node.indexOf("/"),_posEnd=node.indexOf("/",_pos+1),value=node.substring(_pos+1,_posEnd-1),_type="src",_tagName="SCRIPT";if(0!=_pos){var arr_type=node.substring(0,_pos).split(":");arr_type.length>1?(_type=arr_type[1],_tagName=arr_type[0].toUpperCase()):_type=arr_type[0]}node={tagName:_tagName},node[_type]=value}if("string"!=typeof pattern)return!!(pattern instanceof RegExp&&"SCRIPT"===node.tagName&&node.src)&&pattern.test(node.src);if(2!=(pattern.replace(/\\/g,"").match(/\//g)||[]).length)return!1;var pos=pattern.indexOf("/"),posEnd=pattern.indexOf("/",pos+1),blockingType=pattern.substring(posEnd+1),type="src",tagName=null;if(0!=pos){var _arr_type=pattern.substring(0,pos).split(":");_arr_type.length>1?(type=_arr_type[1],tagName=_arr_type[0].toUpperCase()):type=_arr_type[0]}return(!tagName||!node.tagName||tagName===node.tagName)&&(blockingType.length<1&&(blockingType=!0),pattern=pattern.substring(pos,posEnd+1),node[type]?"//"!=pattern&&(!!eval(pattern).test(node[type])&&blockingType):"//"==pattern&&blockingType)},isOnBlacklist=function(t){var e=!1;(patterns.blacklist&&(e=patterns.blacklist.some(function(e){return testPattern(e,t)})),patterns.whitelist)&&(e=!!patterns.whitelist.every(function(e){return!testPattern(e,t)})&&e);return t.type&&t.type===TYPE_ATTRIBUTE&&(e=e||!0),e},willBeUnblocked=function(t){var e=!1;return!patterns.blacklist||0==patterns.blacklist||(patterns.whitelist&&(e=patterns.whitelist.some(function(e){return testPattern(e,t)})),e)},observer=new MutationObserver(function(t){t.forEach(function(t){for(var e=t.addedNodes,r=function(t){var r=e[t];if(1===r.nodeType){var n=isOnBlacklist(r);if("SCRIPT"===r.tagName&&n){backupScripts.blacklisted.push([r.cloneNode(!0),r.parentElement]),blockNodeNoBackup(r,n),r.type=TYPE_ATTRIBUTE;r.addEventListener("beforescriptexecute",function t(e){r.getAttribute("type")===TYPE_ATTRIBUTE&&e.preventDefault(),r.removeEventListener("beforescriptexecute",t)}),r.parentElement.removeChild(r)}else n&&blockNode(r,n)}},n=0;n<e.length;n++)r(n)})});observer.observe(document.documentElement,{childList:!0,subtree:!0});var originalDescriptors={src:Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,"src"),type:Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,"type")},createElementBackup=document.createElement;document.createElement=function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=e[0].toLowerCase(),a=createElementBackup.bind(document).apply(void 0,e);if("script"===n&&(Object.defineProperties(a,{src:{get:function(){return originalDescriptors.src.get.call(this)},set:function(t){return isOnBlacklist({src:t,type:a.type,tagName:"SCRIPT"})&&(a.backup_type=a.type,a.type=TYPE_ATTRIBUTE),originalDescriptors.src.set.call(this,t)}},type:{set:function(t){var e=isOnBlacklist(a);return e&&(a.backup_type=t),originalDescriptors.type.set.call(this,e?TYPE_ATTRIBUTE:t)}}}),a.setAttribute=function(t,e){"type"===t||"src"===t?a[t]=e:HTMLScriptElement.prototype.setAttribute.call(a,t,e)}),patterns.tags.some(function(t){return n===t[0]})){var i={type:{set:function(t){return isOnBlacklist(a)&&(a.backup_type=t,t=TYPE_ATTRIBUTE),originalDescriptors.type.set.call(this,t)}}};i[patterns.tags[n]]={get:function(){return originalDescriptors.src.get.call(this)},set:function(t){var e=isOnBlacklist(a);return e&&(t=blockNodeNoBackup(a,e,patterns.tags[n])),originalDescriptors.src.set.call(this,t)}},Object.defineProperties(a,i),a.setAttribute=function(t,e){t===n||"type"===t?a[t]=e:HTMLScriptElement.prototype.setAttribute.call(a,t,e)}}return a};var toConsumableArray=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)},URL_REPLACER_REGEXP=new RegExp("[|\\{}()[\\]^$+*?.]","g"),unblockId=function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];e.forEach(function(t){if(patternsObj.blacklist instanceof Object)try{unblock(patternsObj.blacklist[t])}catch(t){}if(patternsObj.whitelist instanceof Object)try{unblock(patternsObj.whitelist[t])}catch(t){}})},unblock=function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];e.length<1?(patterns.blacklist=[],patterns.whitelist=["type/javascript\\/blocked/"]):(patterns.blacklist instanceof Array&&(patterns.blacklist=patterns.blacklist.filter(function(t){return e.every(function(e){return e!=t&&("string"==typeof e&&!testPattern(t,e))})})),patterns.whitelist||(patterns.whitelist=[]),patterns.whitelist instanceof Array&&(patterns.whitelist=[].concat(toConsumableArray(patterns.whitelist),toConsumableArray(e.map(function(t){if(!0===t&&(t=new RegExp("^$")),"string"==typeof t)if(""==t||"//"==t)t=new RegExp("^$");else if(t.startsWith("http")||"/"!=t.slice(-1)||2!=(t.replace(/\\/g,"").match(/\//g)||[]).length){var e=t.replace(URL_REPLACER_REGEXP,"\\$&");t="/.*"+e+".*/"}return patterns.whitelist.find(function(e){return e.toString()===t.toString()})?null:t}).filter(Boolean)))));for(var n=document.querySelectorAll('script[type="'+TYPE_ATTRIBUTE+'"]'),a=0;a<n.length;a++){var i=n[a];willBeUnblocked(i)&&(i.setAttribute("type","application/javascript"),backupScripts.blacklisted.push([i,i.parentElement]),i.parentElement.removeChild(i))}var s=0;[].concat(toConsumableArray(backupScripts.blacklisted)).forEach(function(t,e){var r=t[0],n=t[1];if(willBeUnblocked(r)){if(r.type&&r.type===TYPE_ATTRIBUTE&&r.backup_type&&r.setAttribute("type",r.backup_type),"javascript/blocked"===r.type&&r.setAttribute("type","application/javascript"),"SCRIPT"==r.tagName&&r.src){var a=document.createElement("SCRIPT");a.setAttribute("src",r.src),a.setAttribute("type","application/javascript"),r=a}n.appendChild(r),backupScripts.blacklisted.splice(e-s,1),s++}}),window.localStorage.YETT_BLACKLIST=jsonStringify(patterns.blacklist),window.localStorage.YETT_WHITELIST=jsonStringify(patterns.whitelist),(!patterns.blacklist||patterns.blacklist&&patterns.blacklist.length<1)&&observer.disconnect()},block=function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];patterns.whitelist instanceof Array&&(patterns.whitelist=patterns.whitelist.filter(function(t){return e.every(function(e){return e!=t&&("string"==typeof e&&!testPattern(t,e))})})),patterns.blacklist||(patterns.blacklist=[]),patterns.blacklist=[].concat(toConsumableArray(patterns.blacklist),toConsumableArray(e.map(function(t){if("string"==typeof t)if(""==t||"//"==t)t=new RegExp("^$");else if(t.startsWith("http")||"/"!=t.slice(-1)||2!=(t.replace(/\\/g,"").match(/\//g)||[]).length){var e=t.replace(URL_REPLACER_REGEXP,"\\$&");t="/.*"+e+".*/"}return patterns.blacklist.find(function(e){return e.toString()===t.toString()})?null:t}).filter(Boolean))),window.localStorage.YETT_BLACKLIST=jsonStringify(patterns.blacklist),window.localStorage.YETT_WHITELIST=jsonStringify(patterns.whitelist)};exports.unblock=unblock,exports.unblockId=unblockId,exports.block=block,Object.defineProperty(exports,"__esModule",{value:!0})});
//# sourceMappingURL=yett.min.js.map
